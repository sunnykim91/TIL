## VDOM - virtual dom
- React의 메모리에 가상의 DOM 트리를 유지함(실제 DOM의 복사본)
- 자바스크립트 객체이다. 즉, 객체 조작은 빠르기때문에 실제 DOM을 조작하는것보다 성능이 좋다.
- 하지만, 모든 트리의 정보가 복사되는것은 아님. UI 렌더링에 필요한 최소한의 정보만 담고 있는 JavaScript 객체 트리이다.

## Reconciliation(재조정)
- state나 props 가 변경되면 React는 새로운 VDOM을 트리를 구성한다.
- Diffing알고리즘 : React는 이전 VDOM트리와 새 트리를 비교한다.
- 최소 변경사항 계산 : 두 트리간의 차이를 파악해서 최소 DOM 업데이트 집합을 계산
- 일괄 업데이트 : 계산된 변경사항을 실제 DOM에 한번에 적용

## Diffing알고리즘
- 2가지 가정에 기반한다.
- 1. 다른 타입의 요소는 다른 트리를 생성한다.
  2. 개발자가 key속성으로 여러 렌더링에서 어떤자식요소를 가지고있는지 표시한다.
- ```typescript
  // 초기 렌더링
  <div>
    <p>Hello</p>
  </div>
  
  // 업데이트 후
  <div>
    <p>Hello</p>
    <span>World</span>
  </div>
  ```
  - div가 그대로 유지됨을 인식
  - <p>Hello</p> 는 변경되지 않았음을 인식
  - <span>World</span>가 추가되었음 인식하고 해당 DOM노드만 추가
  - 만약 div가 p로 변경되는 경우는 변경됨을 감지해서 이전 트리를 제거하고, 새 트리를 구축합니다.
- ```typescript
  // 이전 렌더링
   <ul>
    <li key="first">First</li>
    <li key="second">Second</li>
  </ul>
  
  // 업데이트 후
  <ul>
    <li key="zero">Zero</li>
    <li key="first">First</li>
    <li key="second">Second</li>
  </ul>
  // key를 사용해야 zero란 항목이 추가되었고, 다른 항목들은 이동되었음을 인식한다.
  ```
- 이래서 key를 사용해야하는것이다.
- 그럼 인덱스를 사용하지 말아야하는 이유는? 배열 인덱스를 key로 사용하지 말아야 하는 이유는 배열이 변경될 때 문제가 발생하기 때문입니다. 예를 들어, 배열의 중간에 있는 요소를 삭제하면 그 뒤에 있던 모든 요소들의 인덱스가 바뀝니다. React는 key를 기준으로 요소를 식별하므로, 인덱스가 key인 경우 삭제 후 남은 요소들은 이전과 다른 key를 갖게 됩니다. 이로 인해 React는 단순히 한 요소만 제거하는 대신, 변경된 인덱스를 가진 모든 요소들을 불필요하게 업데이트합니다.


## React의 업데이트 과정 설명
- state, props 가 변경된다, 렌더단계와 커밋단계를 거쳐 렌더되는데 상세히 알아보자.
- 렌더단계
  - 컴포넌트 함수가 다시 호출
  - 가상 DOM 생성
  - Diffing알고리즘 실행 -> 작업 목록을 만듬
  - Fiber아키텍처에 의해 렌더링작업을 작은 단위로 나누고, 중단할 수 있게함.
- 커밋단계
  - DOM 업데이트 -> 계산된 변경 사항이 실제 DOM에 적용, 동기적으로 이뤄짐, 중단 불가
  - 라이프사이클 메서드/훅 실행
  - 화면 업데이트
  - useEffect 훅 비동기적 실행   
